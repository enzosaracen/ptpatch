// global variables
int break_cnt = 0;
long saved_rdx = 0;

%%

// hook at a specific address
<@ base+0x1151
    break_cnt++;
    printf("Hit breakpoint at base+0x1151 %d times\n", break_cnt);
@>

<@ pre-syscall write
    // intercept and modify the buffer being written
    mem_write((char*)regs.rsi, "intercepted!\n", 13);
    saved_rdx = regs.rdx;
    regs.rdx = 13; // update the number of bytes to write
@>

<@ post-syscall write
    // restore the original number of bytes written
    regs.rax = saved_rdx;
@>
